(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{201:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("p",[s._v("该模块位于 "),a("a",{attrs:{href:"https://github.com/sailist/thexp/blob/master/thexp/frame/trainer.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("thexp.frame.trainer"),a("OutboundLink")],1),s._v(" 是一套整合了之前提到的各模块，添加了回调机制，以及抽象出了完整训练逻辑的一个模块，主要类为 "),a("code",[s._v("Trainer")]),s._v("。")]),s._v(" "),s._m(1),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4),s._m(5),s._v(" "),a("p",[s._v("下面展示了一个简单的完整的训练流程")]),s._v(" "),a("p",[s._v("模型部份")]),s._v(" "),s._m(6),s._m(7),s._v(" "),s._m(8),a("p",[s._v("运行该文件，如果没有意外，你会看到类似如下的输出：")]),s._v(" "),s._m(9),s._m(10),s._v(" "),s._m(11),s._v(" "),s._m(12),s._v(" "),s._m(13),a("p",[s._v("此时构造的实验名就会变成")]),s._v(" "),s._m(14),s._m(15),s._v(" "),s._m(16),s._v(" "),s._m(17),s._v(" "),s._m(18),s._v(" "),a("p",[s._v("所有回调类的注册方法均通过 "),a("code",[s._v("hook(trainer)")]),s._v(" 来完成，"),a("code",[s._v("thexp")]),s._v("提供了众多的回调函数，包括自动保存、日志自动输出等，位于 "),a("a",{attrs:{href:"https://github.com/sailist/thexp/blob/master/thexp/frame/callbacks.py",target:"_blank",rel:"noopener noreferrer"}},[s._v("thexp.frame.callbacks"),a("OutboundLink")],1),s._v("，但可以通过下面的语句直接导入：")]),s._v(" "),s._m(19),a("p",[s._v("你可以在 "),a("router-link",{attrs:{to:"/cookbook/2-structure.html"}},[s._v("项目结构")]),s._v(" 中看到更多关于回调函数的用法。")],1)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"试验流程抽象：trainer"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#试验流程抽象：trainer","aria-hidden":"true"}},[this._v("#")]),this._v(" 试验流程抽象：Trainer")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("Trainer")]),s._v(" 类内部维护了之前提到的中的 "),a("code",[s._v("Saver")]),s._v("/"),a("code",[s._v("RndManager")]),s._v("/"),a("code",[s._v("Logger")]),s._v("/"),a("code",[s._v("Experiment")]),s._v(" 变量，同时还维护了 Tensorboard中的 "),a("code",[s._v("SummaryWritter")]),s._v("，这些方式均通过 "),a("code",[s._v("@property")]),s._v(" 注解实现了懒加载，在使用到时才会创建，并在 "),a("code",[s._v("Experiment")]),s._v(" 中进行相关插件的注册。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"内部维护变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#内部维护变量","aria-hidden":"true"}},[this._v("#")]),this._v(" 内部维护变量")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("在下面的示例中可以看到 "),a("code",[s._v("Trainer")]),s._v(" 维护的这些变量，其中，"),a("code",[s._v("saver")]),s._v("/"),a("code",[s._v("rnd")]),s._v("/"),a("code",[s._v("logger")]),s._v("/"),a("code",[s._v("writter")]),s._v(" 均使用懒加载，仅在使用时会请求 "),a("code",[s._v("experiment")]),s._v(" 分配目录和生成文件。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Params\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" random\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("myTrainer")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n\ntrainer "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" myTrainer"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Params"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("range")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("50")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logger"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("info"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),a("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token builtin"}},[s._v("range")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("20")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("writter"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_scalar"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v('"test"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("random"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("random"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("i"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("# trainer.saver")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("# trainer.rnd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"完整训练流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#完整训练流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 完整训练流程")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" torch"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nn "),a("span",{attrs:{class:"token keyword"}},[s._v("as")]),s._v(" nn\n"),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MyModel")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nn"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Module"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("__init__")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{attrs:{class:"token builtin"}},[s._v("super")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fc "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" nn"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Linear"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("28")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("28")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("forward")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        x "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" x"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("view"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shape"),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token number"}},[s._v("0")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("-")]),a("span",{attrs:{class:"token number"}},[s._v("1")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        x "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fc"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" x\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("Trainer部份：定义一个类，并重写 "),a("code",[s._v("callbacks")]),s._v("/"),a("code",[s._v("datasets")]),s._v("/"),a("code",[s._v("models")]),s._v("/"),a("code",[s._v("train_batch")]),s._v(" 方法")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("frame "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Meter"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Params"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Trainer\n"),a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MyTrainer")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("callbacks")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" callbacks\n        callbacks"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LoggerCallback"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hook"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("# 添加日志输出功能")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("datasets")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torchvision "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" transforms\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torchvision"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datasets "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" FakeData\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("torch"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dataloader "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" DataLoader\n\n        dataset "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" FakeData"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("size"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("32")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("10")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" image_size"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token number"}},[s._v("28")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("28")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" transform"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("transforms"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ToTensor"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        train_loader "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" eval_loader "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" test_loader "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" DataLoader"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dataset"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" shuffle"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token boolean"}},[s._v("True")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_size"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("32")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" drop_last"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token boolean"}},[s._v("True")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("regist_databundler"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            train"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("train_loader"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            test"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("test_loader"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{attrs:{class:"token builtin"}},[s._v("eval")]),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("eval_loader"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("models")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Params"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" torch"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SGD\n        self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" MyModel"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" SGD"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parameters"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" lr"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("params"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lr"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cross "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" nn"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CrossEntropyLoss"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("train_batch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" eidx"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" idx"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" global_step"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_data"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" device"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        optim"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cross "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optim"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cross\n        meter "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" Meter"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        xs"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ys "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" batch_data\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 训练逻辑")]),s._v("\n        logits "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("model"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("xs"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        meter"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loss "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" cross"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("logits"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ys"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),a("span",{attrs:{class:"token comment"}},[s._v("# 反向传播")]),s._v("\n        meter"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loss"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backward"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optim"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("step"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        optim"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("zero_grad"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" meter\n\n\nparams "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" Params"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nparams"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("epoch"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token number"}},[s._v("20")]),s._v("\nparams"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lr "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0.01")]),s._v("\n\ntrainer "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" MyTrainer"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("params"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ntrainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("train"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("add output channel on ...\\__main__.myExp\\0016.748d0b10\\o.200515162902.0.log\n20-05-15 16:29:02 | Exp BaseDir | ...\\__main__.myExp\n20-05-15 16:29:02 | Exp Trainer | MyTrainer\n20-05-15 16:29:02 | Exp Params | Params[('epoch', 20),\n ('eidx', 1),\n ('idx', 0),\n ('global_step', 0),\n ('device', 'cpu'),\n ('dataset', None),\n ('architecture', None),\n ('optim', None),\n ('lr', 0.01)]\n20-05-15 16:36:17 | <LoggerCallback([priority=0]) at 0x0000018DD2733908> hooked on <__main__.MyTrainer object at 0x0000018DCFB6ECC0>.\n20-05-15 16:36:17 | 1/20\n20-05-15 16:36:17 | 8/10 | loss: 2.3161(2.3121)\n20-05-15 16:36:17 | train: 0s | epoch: 0s | avg: 0s | last: 8s\n20-05-15 16:36:17 | 2/20\n20-05-15 16:36:18 | 8/10 | loss: 2.3442(2.2952)\n20-05-15 16:36:18 | train: 0s | epoch: 0s | avg: 0s | last: 8s\n20-05-15 16:36:18 | 3/20\n20-05-15 16:36:18 | 8/10 | loss: 2.3278(2.2851)\n20-05-15 16:36:18 | train: 1s | epoch: 0s | avg: 0s | last: 7s\n20-05-15 16:36:18 | 4/20\n...\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"更改试验名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更改试验名","aria-hidden":"true"}},[this._v("#")]),this._v(" 更改试验名")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("上面的日志中，可以看到实验级别的目录名为 "),a("code",[s._v("__main__.myExp")]),s._v(" 。"),a("code",[s._v("Trainer")]),s._v("中维护了一个类变量 "),a("code",[s._v("__exp_name__")]),s._v("，其默认值为小写化的类名，且 "),a("code",[s._v("trainer")]),s._v(" 被替换成 "),a("code",[s._v("Exp")]),s._v("。"),a("code",[s._v("Trainer")]),s._v("中实验名的构造方法为 "),a("code",[s._v("{模块名}.{__exp_name__}")]),s._v("。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("如果需要主动命名实验，则需要更改该类的类变量 "),t("code",[this._v("__exp_name__")]),this._v("：，此时实验名构造为 "),t("code",[this._v("{模块名}.{__exp_name__}")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("MyTrainer")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Trainer"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    __exp_name__ "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"DemoExp"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("...\\__main__.DemoExp\\0001.3902568d\\o.200515170325.0.log\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),t("p",[this._v("添加模块名是为了尽可能的保证实验名唯一。请尽可能的对各实验采用不同的，易于区分的命名方式。")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"回调函数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#回调函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 回调函数")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[a("code",[s._v("thexp")]),s._v(" 为 "),a("code",[s._v("Trainer")]),s._v(" 提供了一套回调机制，在之前的示例中，"),a("code",[s._v("MyTrainer")]),s._v("类重写了 "),a("code",[s._v("callbacks()")]),s._v(" 方法，并在其中注册了 "),a("code",[s._v("LoggerCallback")]),s._v("，从而在训练过程中能够自动完成日志输出。如果不注册该回调类，则在大多数过程中程序都会保持静默。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("TIP")]),this._v(" "),t("p",[this._v("在 "),t("code",[this._v("Trainer")]),this._v(" 的一些方法中，也有一些方法会主动的进行日志输出。")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" thexp "),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" callbacks\n"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])}],!1,null,null,null);e.options.__file="9-trainer.md";t.default=e.exports}}]);